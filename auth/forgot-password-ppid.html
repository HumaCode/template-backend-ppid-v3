<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lupa Password — PPID Kota Pekalongan</title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    /* ============================================================
       BASE VARIABLES & RESET  (shared with login & register)
    ============================================================ */
    :root {
      --blue:         #0072c6;
      --blue-dark:    #005499;
      --blue-deep:    #003d70;
      --blue-light:   #1a8fe0;
      --blue-glow:    rgba(0,114,198,0.35);
      --glass:        rgba(255,255,255,0.07);
      --glass-border: rgba(255,255,255,0.15);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: #001f42;
      overflow: hidden;
    }

    /* ── CANVAS BACKGROUND ── */
    #bg-canvas { position: fixed; inset: 0; z-index: 0; }

    /* ── MESH GRADIENT ── */
    .mesh {
      position: fixed; inset: 0; z-index: 1;
      background:
        radial-gradient(ellipse 80% 60% at 15% 20%, rgba(0,114,198,0.55) 0%, transparent 60%),
        radial-gradient(ellipse 60% 80% at 85% 80%, rgba(0,84,153,0.45)  0%, transparent 60%),
        radial-gradient(ellipse 50% 50% at 50% 50%, rgba(0,61,112,0.3)   0%, transparent 70%);
      animation: meshShift 12s ease-in-out infinite alternate;
    }
    @keyframes meshShift { 0% { opacity:.85; } 100% { opacity:1; } }

    /* ── FLOATING ORBS ── */
    .orb {
      position: fixed; border-radius: 50%;
      filter: blur(80px); opacity: 0.25; z-index: 1;
      animation: orbFloat linear infinite;
    }
    .orb-1 { width:500px;height:500px;background:#0072c6;top:-100px;left:-100px;animation-duration:20s; }
    .orb-2 { width:350px;height:350px;background:#1a8fe0;bottom:-80px;right:-60px;animation-duration:15s;animation-delay:-5s; }
    .orb-3 { width:250px;height:250px;background:#005499;top:40%;left:60%;animation-duration:18s;animation-delay:-9s; }
    @keyframes orbFloat {
      0%,100% { transform:translateY(0) scale(1); }
      33%     { transform:translateY(-40px) scale(1.05); }
      66%     { transform:translateY(20px) scale(0.97); }
    }

    /* ── GRID OVERLAY ── */
    .grid-overlay {
      position: fixed; inset: 0; z-index: 2;
      background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 60px 60px;
    }

    /* ── PARTICLES ── */
    .particles { position:fixed;inset:0;z-index:2;pointer-events:none;overflow:hidden; }
    .particle {
      position:absolute; border-radius:50%;
      background:rgba(0,180,255,0.6);
      animation:particleFloat linear infinite;
    }
    @keyframes particleFloat {
      0%   { transform:translateY(100vh) translateX(0);             opacity:0; }
      10%  { opacity:.8; }
      90%  { opacity:.5; }
      100% { transform:translateY(-20vh) translateX(var(--drift));  opacity:0; }
    }

    /* ── PAGE WRAPPER ── */
    .page-wrapper {
      position:relative; z-index:10;
      min-height:100dvh;
      display:flex; align-items:center; justify-content:center;
      padding:1.5rem;
      overflow-y:auto; scrollbar-width:none;
    }
    .page-wrapper::-webkit-scrollbar { display:none; }

    /* ── ANIMATIONS ── */
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(18px); }
      to   { opacity:1; transform:translateY(0); }
    }
    @keyframes cardIn {
      from { opacity:0; transform:translateY(40px) scale(.97); }
      to   { opacity:1; transform:translateY(0) scale(1); }
    }
    @keyframes shakeX {
      0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)}
    }
    @keyframes spin { to { transform:rotate(360deg); } }
    @keyframes btnShine {
      0%,100%{ left:-100%; }
      40%,60%{ left:140%; }
    }
    @keyframes badgePulse {
      0%,100% { box-shadow:0 8px 32px rgba(0,114,198,0.5), inset 0 1px 0 rgba(255,255,255,0.25); }
      50%     { box-shadow:0 12px 48px rgba(0,114,198,0.75),inset 0 1px 0 rgba(255,255,255,0.25); }
    }
    @keyframes ringPulse {
      0%,100% { transform:scale(1);    opacity:.5; }
      50%     { transform:scale(1.06); opacity:1;  }
    }
    @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:.2;} }

    /* ── SHARED HEADER ── */
    .ppid-header {
      text-align:center; margin-bottom:1.7rem;
      animation: fadeUp .7s .15s cubic-bezier(.22,1,.36,1) both;
    }
    .icon-badge {
      width:76px; height:76px;
      margin:0 auto 1rem;
      border-radius:22px;
      background:linear-gradient(135deg, var(--blue) 0%, var(--blue-light) 100%);
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 8px 32px rgba(0,114,198,0.5),inset 0 1px 0 rgba(255,255,255,0.25);
      animation:badgePulse 3s ease-in-out infinite;
      position:relative;
    }
    .icon-badge::after {
      content:''; position:absolute; inset:-3px;
      border-radius:25px;
      border:1px solid rgba(0,114,198,0.4);
      animation:ringPulse 3s ease-in-out infinite;
    }
    .icon-badge i { font-size:2rem; color:#fff; }

    .ppid-label {
      display:inline-flex; align-items:center; gap:.4rem;
      background:rgba(0,114,198,0.2);
      border:1px solid rgba(0,114,198,0.35);
      border-radius:100px; padding:.25rem .9rem;
      font-size:.72rem; font-weight:600;
      letter-spacing:.12em; text-transform:uppercase;
      color:#7ecbff; margin-bottom:.6rem;
    }
    .ppid-label .dot {
      width:6px; height:6px; border-radius:50%;
      background:#7ecbff; animation:blink 1.4s ease-in-out infinite;
    }

    .card-title {
      font-family:'Playfair Display',serif;
      font-size:1.6rem; font-weight:700;
      color:#fff; line-height:1.2; margin-bottom:.3rem;
    }
    .card-subtitle { font-size:.82rem; color:rgba(255,255,255,0.5); font-weight:300; }

    /* ── DIVIDER ── */
    .line-divider {
      display:flex; align-items:center; gap:.7rem;
      margin-bottom:1.5rem;
      animation:fadeUp .7s .2s cubic-bezier(.22,1,.36,1) both;
    }
    .line-divider span { flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent); }
    .line-divider small { color:rgba(255,255,255,0.25);font-size:.7rem;white-space:nowrap;letter-spacing:.08em; }

    /* ── FORM ELEMENTS (shared) ── */
    .form-wrap { animation:fadeUp .7s .25s cubic-bezier(.22,1,.36,1) both; }
    .form-group { margin-bottom:1.1rem; }
    .form-label {
      display:block; font-size:.78rem; font-weight:600;
      letter-spacing:.05em; color:rgba(255,255,255,0.6); margin-bottom:.45rem;
    }
    .input-wrap { position:relative; }
    .input-icon {
      position:absolute; left:14px; top:50%; transform:translateY(-50%);
      color:rgba(255,255,255,0.3); font-size:.95rem;
      pointer-events:none; transition:color .25s;
    }
    .form-control-custom {
      width:100%;
      background:rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:12px;
      padding:.75rem 1rem .75rem 2.7rem;
      color:#fff;
      font-family:'Plus Jakarta Sans',sans-serif;
      font-size:.9rem; outline:none;
      transition:border-color .25s, background .25s, box-shadow .25s;
    }
    .form-control-custom::placeholder { color:rgba(255,255,255,0.22); }
    .form-control-custom:focus {
      border-color:var(--blue);
      background:rgba(0,114,198,0.12);
      box-shadow:0 0 0 3px rgba(0,114,198,0.2),0 4px 16px rgba(0,0,0,0.2);
    }
    .input-wrap:focus-within .input-icon { color:var(--blue-light); }

    /* eye toggle */
    .eye-toggle {
      position:absolute; right:13px; top:50%; transform:translateY(-50%);
      background:none; border:none; color:rgba(255,255,255,0.3);
      cursor:pointer; padding:0; font-size:.9rem; transition:color .2s;
    }
    .eye-toggle:hover { color:rgba(255,255,255,0.7); }
    .pw-wrap .form-control-custom { padding-right:2.8rem; }

    /* ── BTN PRIMARY ── */
    .btn-primary-custom {
      width:100%; padding:.82rem; border:none; border-radius:12px;
      background:linear-gradient(135deg, var(--blue) 0%, var(--blue-light) 100%);
      color:#fff; font-family:'Plus Jakarta Sans',sans-serif;
      font-size:.95rem; font-weight:600; letter-spacing:.03em;
      cursor:pointer; position:relative; overflow:hidden;
      transition:transform .2s, box-shadow .2s;
      box-shadow:0 8px 28px rgba(0,114,198,0.45);
    }
    .btn-primary-custom::before {
      content:''; position:absolute; inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,.15) 0%,transparent 60%);
      opacity:0; transition:opacity .25s;
    }
    .btn-primary-custom:hover::before { opacity:1; }
    .btn-primary-custom:hover { transform:translateY(-2px); box-shadow:0 14px 40px rgba(0,114,198,0.55); }
    .btn-primary-custom:active { transform:translateY(0); }
    .btn-primary-custom::after {
      content:''; position:absolute;
      top:0; left:-100%; width:60%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
      transform:skewX(-20deg);
      animation:btnShine 3.5s ease-in-out infinite 1s;
    }

    /* ── BTN GHOST (kembali) ── */
    .btn-ghost {
      display:inline-flex; align-items:center; gap:.4rem;
      background:none; border:none; cursor:pointer;
      color:rgba(255,255,255,0.4); font-size:.82rem;
      font-family:'Plus Jakarta Sans',sans-serif;
      font-weight:500; padding:0;
      transition:color .2s;
    }
    .btn-ghost:hover { color:#7ecbff; }

    /* ── SPINNER ── */
    .spinner {
      display:none; width:18px; height:18px;
      border:2.5px solid rgba(255,255,255,0.3);
      border-top-color:#fff; border-radius:50%;
      animation:spin .7s linear infinite; margin:0 auto;
    }

    /* ── ALERTS ── */
    .alert-glass {
      background:rgba(220,50,50,0.15);
      border:1px solid rgba(220,50,50,0.3);
      border-radius:10px; padding:.65rem .9rem;
      color:#ffaaaa; font-size:.82rem; margin-bottom:1rem;
      display:none; animation:shakeX .4s;
    }
    .alert-success-glass {
      background:rgba(0,180,100,0.15);
      border:1px solid rgba(0,200,120,0.3);
      border-radius:10px; padding:.65rem .9rem;
      color:#7effc8; font-size:.82rem; margin-bottom:1rem;
      display:none;
    }

    /* ── BOTTOM LINK ── */
    .bottom-link {
      text-align:center; margin-top:1.1rem;
      font-size:.82rem; color:rgba(255,255,255,0.4);
    }
    .bottom-link a {
      color:#7ecbff; text-decoration:none; font-weight:600;
      transition:color .2s;
    }
    .bottom-link a:hover { color:#fff; }

    /* ── FOOTER ── */
    .card-footer-custom {
      text-align:center; margin-top:1.4rem;
      padding-top:1.2rem;
      border-top:1px solid rgba(255,255,255,0.07);
      animation:fadeUp .7s .35s cubic-bezier(.22,1,.36,1) both;
    }
    .footer-text { font-size:.75rem; color:rgba(255,255,255,0.3); line-height:1.6; }
    .footer-text strong { color:rgba(255,255,255,0.55); font-weight:600; }

    /* ============================================================
       ------- forgot password style ------
       forgot-card
    ============================================================ */

    .forgot-card {
      width:100%; max-width:440px;
      background:rgba(255,255,255,0.06);
      backdrop-filter:blur(28px) saturate(1.4);
      -webkit-backdrop-filter:blur(28px) saturate(1.4);
      border:1px solid var(--glass-border);
      border-radius:24px; overflow:hidden;
      box-shadow:
        0 0 0 1px rgba(0,114,198,0.2),
        0 32px 80px rgba(0,0,0,0.45),
        inset 0 1px 0 rgba(255,255,255,0.12);
      animation:cardIn .9s cubic-bezier(.22,1,.36,1) both;
    }

    /* forgot-card inner — hidden scrollbar */
    .forgot-card .card-inner {
      max-height:95dvh;
      overflow-y:auto;
      scrollbar-width:none;          /* Firefox */
      padding:2.4rem 2.2rem 2.2rem;
    }
    .forgot-card .card-inner::-webkit-scrollbar { display:none; } /* Chrome / Safari */

    /* ── PROGRESS TRACK (step dots) ── */
    .progress-track {
      display:flex; justify-content:center;
      align-items:center; gap:.5rem;
      margin-bottom:1.6rem;
      animation:fadeUp .7s .18s cubic-bezier(.22,1,.36,1) both;
    }
    .prog-dot {
      width:8px; height:8px; border-radius:50%;
      background:rgba(255,255,255,0.12);
      transition:all .4s cubic-bezier(.22,1,.36,1);
    }
    .prog-dot.active {
      width:28px; border-radius:4px;
      background:var(--blue);
      box-shadow:0 0 10px rgba(0,114,198,0.6);
    }
    .prog-dot.done {
      background:var(--blue-dark);
    }

    /* ── SECTION TRANSITION ── */
    .fp-section { display:none; }
    .fp-section.active {
      display:block;
      animation:sectionIn .4s cubic-bezier(.22,1,.36,1) both;
    }
    @keyframes sectionIn {
      from { opacity:0; transform:translateX(20px); }
      to   { opacity:1; transform:translateX(0); }
    }

    /* ── OTP INPUT GROUP ── */
    .otp-group {
      display:flex; gap:.5rem; justify-content:center;
      margin:.3rem 0 .2rem;
    }
    .otp-input {
      width:52px; height:56px;
      text-align:center;
      font-size:1.3rem; font-weight:700;
      background:rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:12px; color:#fff; outline:none;
      font-family:'Plus Jakarta Sans',sans-serif;
      caret-color:var(--blue-light);
      transition:border-color .25s, background .25s, box-shadow .25s, transform .15s;
    }
    .otp-input:focus {
      border-color:var(--blue);
      background:rgba(0,114,198,0.14);
      box-shadow:0 0 0 3px rgba(0,114,198,0.22);
      transform:scale(1.06);
    }
    .otp-input.filled {
      border-color:var(--blue-dark);
      background:rgba(0,114,198,0.18);
      color:#7ecbff;
    }

    .otp-hint {
      text-align:center; font-size:.75rem;
      color:rgba(255,255,255,0.3); margin-top:.5rem;
    }
    .otp-hint strong { color:#7ecbff; cursor:pointer; transition:color .2s; }
    .otp-hint strong:hover { color:#fff; }

    /* ── COUNTDOWN TIMER ── */
    .countdown-wrap {
      display:flex; align-items:center; justify-content:center;
      gap:.4rem; margin-top:.8rem;
    }
    .countdown-ring {
      width:36px; height:36px; position:relative;
    }
    .countdown-ring svg { width:36px; height:36px; transform:rotate(-90deg); }
    .countdown-ring circle {
      fill:none; stroke-width:3;
      stroke-linecap:round;
    }
    .ring-bg    { stroke:rgba(255,255,255,0.08); }
    .ring-prog  {
      stroke:var(--blue);
      stroke-dasharray:88;
      stroke-dashoffset:0;
      transition:stroke-dashoffset 1s linear;
    }
    .countdown-num {
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      font-size:.68rem; font-weight:700; color:#7ecbff;
    }
    .countdown-label { font-size:.78rem; color:rgba(255,255,255,0.35); }

    /* ── SUCCESS ICON ── */
    .success-icon-wrap {
      width:80px; height:80px;
      margin:0 auto 1.2rem;
      border-radius:50%;
      background:linear-gradient(135deg,rgba(0,180,100,0.2),rgba(0,200,130,0.1));
      border:1.5px solid rgba(0,200,130,0.3);
      display:flex; align-items:center; justify-content:center;
      animation:successPop .6s cubic-bezier(.22,1,.36,1) both;
    }
    @keyframes successPop {
      0%   { opacity:0; transform:scale(.6); }
      70%  { transform:scale(1.1); }
      100% { opacity:1; transform:scale(1); }
    }
    .success-icon-wrap i { font-size:2.2rem; color:#40e090; }

    .success-check-anim {
      animation:successPop .6s cubic-bezier(.22,1,.36,1) .1s both;
    }

    /* ── INFO BOX ── */
    .info-box {
      background:rgba(0,114,198,0.1);
      border:1px solid rgba(0,114,198,0.22);
      border-radius:12px; padding:.8rem 1rem;
      font-size:.8rem; color:rgba(255,255,255,0.5);
      line-height:1.6; margin-bottom:1.2rem;
      display:flex; gap:.6rem; align-items:flex-start;
    }
    .info-box i { color:#7ecbff; font-size:1rem; flex-shrink:0; margin-top:.05rem; }

    /* ── PASSWORD STRENGTH ── */
    .pw-strength {
      margin-top:.45rem; height:3px; border-radius:2px;
      background:rgba(255,255,255,0.08); overflow:hidden;
    }
    .pw-strength-bar {
      height:100%; border-radius:2px; width:0%;
      transition:width .4s ease, background .4s ease;
    }
    .pw-strength-label { font-size:.68rem; color:rgba(255,255,255,0.35); margin-top:.3rem; }

    /* ============================================================
       RESPONSIVE — forgot-card
    ============================================================ */

    /* Mobile ≤ 480px */
    @media (max-width:480px) {
      .forgot-card .card-inner { padding:1.8rem 1.3rem; }
      .card-title  { font-size:1.38rem; }
      .icon-badge  { width:64px; height:64px; border-radius:18px; }
      .icon-badge i { font-size:1.6rem; }
      .otp-input   { width:42px; height:48px; font-size:1.1rem; }
      .forgot-card { border-radius:20px; }
    }

    /* Tablet 481–767px */
    @media (min-width:481px) and (max-width:767px) {
      .forgot-card { max-width:420px; }
    }

    /* Desktop ≥ 992px */
    @media (min-width:992px) {
      .forgot-card { max-width:460px; }
    }

  </style>
</head>
<body>

  <!-- Background Layers -->
  <canvas id="bg-canvas"></canvas>
  <div class="mesh"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
  <div class="grid-overlay"></div>
  <div class="particles" id="particles"></div>

  <!-- Page -->
  <div class="page-wrapper">
    <div class="forgot-card">
      <div class="card-inner">

        <!-- Header -->
        <div class="ppid-header">
          <div class="icon-badge">
            <i class="bi bi-shield-lock-fill" id="headerIcon"></i>
          </div>
          <div class="ppid-label">
            <span class="dot"></span>
            <span id="labelText">Pemulihan Akun</span>
          </div>
          <h1 class="card-title" id="pageTitle">Lupa Password?</h1>
          <p class="card-subtitle" id="pageSubtitle">
            Masukkan email Anda dan kami akan mengirimkan<br>kode verifikasi untuk mereset password.
          </p>
        </div>

        <!-- Progress Dots -->
        <div class="progress-track">
          <div class="prog-dot active" id="dot1"></div>
          <div class="prog-dot" id="dot2"></div>
          <div class="prog-dot" id="dot3"></div>
        </div>

        <!-- Divider -->
        <div class="line-divider">
          <span></span>
          <small id="stepLabel">Langkah 1 · Verifikasi Email</small>
          <span></span>
        </div>

        <!-- Alert -->
        <div class="alert-glass"   id="alertBox"><i class="bi bi-exclamation-circle me-1"></i><span id="alertMsg"></span></div>
        <div class="alert-success-glass" id="alertSuccess"><i class="bi bi-check-circle me-1"></i><span id="successMsg"></span></div>

        <!-- ════ STEP 1 : EMAIL ════ -->
        <div class="fp-section active" id="step1">
          <form id="formEmail" class="form-wrap" novalidate>

            <div class="info-box">
              <i class="bi bi-info-circle-fill"></i>
              <span>Pastikan email yang Anda masukkan terdaftar di sistem PPID Kota Pekalongan.</span>
            </div>

            <div class="form-group">
              <label class="form-label">Alamat Email Terdaftar</label>
              <div class="input-wrap">
                <input type="email" class="form-control-custom" id="emailInput"
                  placeholder="contoh@email.com" autocomplete="email" />
                <i class="bi bi-envelope input-icon"></i>
              </div>
            </div>

            <button type="submit" class="btn-primary-custom" id="btnEmail">
              <span id="btnEmailText"><i class="bi bi-send me-2"></i>Kirim Kode Verifikasi</span>
              <div class="spinner" id="spinnerEmail"></div>
            </button>

          </form>

          <div class="bottom-link" style="margin-top:1.1rem;">
            <button class="btn-ghost" onclick="goLogin()">
              <i class="bi bi-arrow-left"></i> Kembali ke halaman Login
            </button>
          </div>
        </div>

        <!-- ════ STEP 2 : OTP ════ -->
        <div class="fp-section" id="step2">
          <form id="formOtp" class="form-wrap" novalidate>

            <div class="info-box">
              <i class="bi bi-envelope-check-fill"></i>
              <span>Kode 6 digit telah dikirim ke <strong id="emailTarget" style="color:#7ecbff;"></strong>. Periksa folder Spam jika tidak muncul.</span>
            </div>

            <!-- OTP Inputs -->
            <div class="form-group">
              <label class="form-label" style="text-align:center; display:block;">Masukkan Kode OTP</label>
              <div class="otp-group">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp0" />
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp1" />
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp2" />
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp3" />
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp4" />
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" id="otp5" />
              </div>
            </div>

            <!-- Countdown -->
            <div class="countdown-wrap">
              <div class="countdown-ring">
                <svg viewBox="0 0 36 36">
                  <circle class="ring-bg"   cx="18" cy="18" r="14"></circle>
                  <circle class="ring-prog" cx="18" cy="18" r="14" id="ringProg"></circle>
                </svg>
                <div class="countdown-num" id="cdNum">60</div>
              </div>
              <span class="countdown-label">detik tersisa</span>
            </div>

            <div class="otp-hint" id="resendWrap" style="display:none;">
              Tidak menerima kode? <strong onclick="resendOtp()">Kirim ulang</strong>
            </div>

            <button type="submit" class="btn-primary-custom mt-3" id="btnOtp">
              <span id="btnOtpText"><i class="bi bi-shield-check me-2"></i>Verifikasi Kode</span>
              <div class="spinner" id="spinnerOtp"></div>
            </button>

          </form>

          <div style="text-align:center;margin-top:.9rem;">
            <button class="btn-ghost" onclick="goStep(1)">
              <i class="bi bi-arrow-left"></i> Ganti email
            </button>
          </div>
        </div>

        <!-- ════ STEP 3 : RESET PASSWORD ════ -->
        <div class="fp-section" id="step3">
          <form id="formReset" class="form-wrap" novalidate>

            <div class="info-box">
              <i class="bi bi-lock-fill"></i>
              <span>Buat password baru yang kuat. Gunakan kombinasi huruf besar, angka, dan simbol.</span>
            </div>

            <!-- Password Baru -->
            <div class="form-group">
              <label class="form-label">Password Baru</label>
              <div class="input-wrap pw-wrap">
                <input type="password" class="form-control-custom" id="newPass"
                  placeholder="Minimal 8 karakter"
                  oninput="checkStrength(this.value)" />
                <i class="bi bi-lock input-icon"></i>
                <button type="button" class="eye-toggle" id="eyeNew">
                  <i class="bi bi-eye" id="eyeIconNew"></i>
                </button>
              </div>
              <div class="pw-strength"><div class="pw-strength-bar" id="strengthBar"></div></div>
              <div class="pw-strength-label" id="strengthLabel">Masukkan password</div>
            </div>

            <!-- Konfirmasi -->
            <div class="form-group">
              <label class="form-label">Konfirmasi Password Baru</label>
              <div class="input-wrap pw-wrap">
                <input type="password" class="form-control-custom" id="confPass"
                  placeholder="Ulangi password baru" />
                <i class="bi bi-lock-fill input-icon"></i>
                <button type="button" class="eye-toggle" id="eyeConf">
                  <i class="bi bi-eye" id="eyeIconConf"></i>
                </button>
              </div>
            </div>

            <button type="submit" class="btn-primary-custom" id="btnReset">
              <span id="btnResetText"><i class="bi bi-arrow-repeat me-2"></i>Reset Password</span>
              <div class="spinner" id="spinnerReset"></div>
            </button>

          </form>
        </div>

        <!-- ════ STEP 4 : SUCCESS ════ -->
        <div class="fp-section" id="step4">
          <div style="text-align:center; padding:.5rem 0 .3rem;">
            <div class="success-icon-wrap success-check-anim">
              <i class="bi bi-check-lg"></i>
            </div>
            <h2 style="font-family:'Playfair Display',serif; font-size:1.45rem; font-weight:700; color:#fff; margin-bottom:.5rem;">
              Password Berhasil Direset!
            </h2>
            <p style="font-size:.83rem; color:rgba(255,255,255,0.45); line-height:1.7; margin-bottom:1.5rem;">
              Password akun Anda telah diperbarui.<br>Silakan login menggunakan password baru Anda.
            </p>
            <button class="btn-primary-custom" onclick="goLogin()">
              <i class="bi bi-box-arrow-in-right me-2"></i>Masuk Sekarang
            </button>
          </div>
        </div>

        <!-- Footer -->
        <div class="card-footer-custom">
          <p class="footer-text">
            <strong>PPID Kota Pekalongan</strong><br>
            Jl. Majapahit No.1, Kota Pekalongan &nbsp;·&nbsp; &copy; 2025<br>
            <span style="color:rgba(255,255,255,0.2);font-size:.7rem;">Sistem Informasi Layanan Publik</span>
          </p>
        </div>

      </div><!-- card-inner -->
    </div><!-- forgot-card -->
  </div><!-- page-wrapper -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* ══════════════════════════════════════════
       CANVAS WAVE BACKGROUND
    ══════════════════════════════════════════ */
    const canvas = document.getElementById('bg-canvas');
    const ctx    = canvas.getContext('2d');
    let W, H, t  = 0;
    function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
    resize();
    window.addEventListener('resize', resize);
    function drawWaves() {
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle='#001229'; ctx.fillRect(0,0,W,H);
      const waves=[
        {amp:60,freq:.008,speed:.4, y:H*.65,alpha:.06},
        {amp:40,freq:.012,speed:.6, y:H*.72,alpha:.05},
        {amp:80,freq:.005,speed:.25,y:H*.80,alpha:.04},
      ];
      waves.forEach(w=>{
        ctx.beginPath(); ctx.moveTo(0,w.y);
        for(let x=0;x<=W;x+=4){
          const y=w.y+Math.sin(x*w.freq+t*w.speed)*w.amp+Math.cos(x*w.freq*.5+t*w.speed*.7)*(w.amp*.4);
          ctx.lineTo(x,y);
        }
        ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.closePath();
        ctx.fillStyle=`rgba(0,114,198,${w.alpha})`;ctx.fill();
      });
      t+=.012; requestAnimationFrame(drawWaves);
    }
    drawWaves();

    /* ══════════════════════════════════════════
       PARTICLES
    ══════════════════════════════════════════ */
    const pCont = document.getElementById('particles');
    for(let i=0;i<28;i++){
      const p=document.createElement('div'); p.className='particle';
      const s=Math.random()*3+1;
      p.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;animation-duration:${8+Math.random()*12}s;animation-delay:-${Math.random()*15}s;--drift:${(Math.random()-.5)*120}px;opacity:${.3+Math.random()*.5};`;
      pCont.appendChild(p);
    }

    /* ══════════════════════════════════════════
       INPUT FOCUS MICRO-INTERACTION
    ══════════════════════════════════════════ */
    document.querySelectorAll('.form-control-custom').forEach(inp=>{
      const wrap=inp.closest('.input-wrap');
      if(!wrap) return;
      wrap.style.transition='transform .2s';
      inp.addEventListener('focus',()=>{ wrap.style.transform='scale(1.01)'; });
      inp.addEventListener('blur', ()=>{ wrap.style.transform=''; });
    });

    /* ══════════════════════════════════════════
       STEP MANAGEMENT
    ══════════════════════════════════════════ */
    const stepLabels = {
      1:'Langkah 1 · Verifikasi Email',
      2:'Langkah 2 · Kode OTP',
      3:'Langkah 3 · Password Baru',
      4:'Selesai',
    };
    const stepTitles = {
      1:['Lupa Password?', 'Masukkan email Anda dan kami akan mengirimkan<br>kode verifikasi untuk mereset password.'],
      2:['Masukkan Kode OTP', 'Periksa inbox atau folder spam email Anda<br>dan masukkan kode 6 digit yang dikirim.'],
      3:['Buat Password Baru', 'Buat password yang kuat dan mudah Anda ingat<br>namun sulit ditebak orang lain.'],
      4:['Reset Berhasil!', 'Password Anda telah berhasil diperbarui.'],
    };
    const dotIds = ['dot1','dot2','dot3'];

    let currentStep = 1;

    function goStep(n) {
      hideAlerts();
      // sections
      document.querySelectorAll('.fp-section').forEach(s=>{ s.classList.remove('active'); s.style.display='none'; });
      const target = document.getElementById(`step${n}`);
      target.style.display='block'; void target.offsetWidth; target.classList.add('active');

      // dots (steps 1-3 map to dots 0-2; step4 = all done)
      dotIds.forEach((id,i)=>{
        const el=document.getElementById(id);
        el.classList.remove('active','done');
        if(i+1 < n)      el.classList.add('done');
        else if(i+1===n || (n===4)) el.classList.add(n===4?'done':'active');
      });
      if(n===4) dotIds.forEach(id=>document.getElementById(id).classList.replace('active','done'));

      // texts
      document.getElementById('stepLabel').textContent    = stepLabels[n];
      document.getElementById('pageTitle').textContent    = stepTitles[n][0];
      document.getElementById('pageSubtitle').innerHTML   = stepTitles[n][1];

      // hide progress & divider on step 4
      document.querySelector('.progress-track').style.display = n===4 ? 'none' : '';
      document.querySelector('.line-divider').style.display   = n===4 ? 'none' : '';
      document.querySelector('.ppid-header').style.display    = n===4 ? 'none' : '';

      // scroll top
      document.querySelector('.card-inner').scrollTo({top:0,behavior:'smooth'});
      currentStep = n;
    }

    function goLogin() { window.location.href = 'login-ppid.html'; }

    /* ══════════════════════════════════════════
       ALERT HELPERS
    ══════════════════════════════════════════ */
    function showAlert(msg){
      const box=document.getElementById('alertBox');
      document.getElementById('alertMsg').textContent=msg;
      box.style.display='block'; box.style.animation='none';
      void box.offsetWidth; box.style.animation='shakeX .4s';
    }
    function hideAlerts(){
      document.getElementById('alertBox').style.display='none';
      document.getElementById('alertSuccess').style.display='none';
    }

    /* ══════════════════════════════════════════
       LOADING STATE HELPER
    ══════════════════════════════════════════ */
    function setLoading(btnId, textId, spinnerId, loading){
      document.getElementById(textId).style.display  = loading ? 'none'  : 'inline';
      document.getElementById(spinnerId).style.display= loading ? 'block' : 'none';
      document.getElementById(btnId).disabled         = loading;
    }

    /* ══════════════════════════════════════════
       STEP 1 — EMAIL SUBMIT
    ══════════════════════════════════════════ */
    document.getElementById('formEmail').addEventListener('submit', async e=>{
      e.preventDefault(); hideAlerts();
      const email = document.getElementById('emailInput').value.trim();
      if(!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        showAlert('Masukkan alamat email yang valid.'); return;
      }
      setLoading('btnEmail','btnEmailText','spinnerEmail',true);
      await new Promise(r=>setTimeout(r,1800)); // simulate API
      setLoading('btnEmail','btnEmailText','spinnerEmail',false);

      document.getElementById('emailTarget').textContent = email;
      startCountdown(60);
      goStep(2);
    });

    /* ══════════════════════════════════════════
       OTP INPUTS — auto-advance & backspace
    ══════════════════════════════════════════ */
    const otpInputs = [...document.querySelectorAll('.otp-input')];
    otpInputs.forEach((inp,i)=>{
      inp.addEventListener('input', e=>{
        inp.value = inp.value.replace(/\D/,'');
        inp.classList.toggle('filled', inp.value !== '');
        if(inp.value && i < 5) otpInputs[i+1].focus();
      });
      inp.addEventListener('keydown', e=>{
        if(e.key==='Backspace' && !inp.value && i>0){
          otpInputs[i-1].focus();
          otpInputs[i-1].value='';
          otpInputs[i-1].classList.remove('filled');
        }
      });
      inp.addEventListener('paste', e=>{
        e.preventDefault();
        const data=(e.clipboardData||window.clipboardData).getData('text').replace(/\D/g,'');
        data.split('').slice(0,6).forEach((ch,j)=>{
          if(otpInputs[j]){ otpInputs[j].value=ch; otpInputs[j].classList.add('filled'); }
        });
        const last=Math.min(data.length,5);
        otpInputs[last].focus();
      });
    });

    /* ══════════════════════════════════════════
       COUNTDOWN TIMER
    ══════════════════════════════════════════ */
    let cdInterval = null;
    const FULL_DASH = 88;

    function startCountdown(seconds){
      clearInterval(cdInterval);
      document.getElementById('resendWrap').style.display='none';
      let rem = seconds;
      const numEl  = document.getElementById('cdNum');
      const ringEl = document.getElementById('ringProg');

      function tick(){
        numEl.textContent = rem;
        const offset = FULL_DASH - (FULL_DASH * rem / seconds);
        ringEl.style.strokeDashoffset = offset;
        if(rem <= 0){
          clearInterval(cdInterval);
          document.getElementById('resendWrap').style.display='block';
          numEl.textContent='0';
        }
        rem--;
      }
      tick(); cdInterval = setInterval(tick, 1000);
    }

    function resendOtp(){
      otpInputs.forEach(i=>{ i.value=''; i.classList.remove('filled'); });
      otpInputs[0].focus();
      startCountdown(60);
      const box=document.getElementById('alertSuccess');
      document.getElementById('successMsg').textContent='Kode OTP baru telah dikirim ke email Anda.';
      box.style.display='block';
      setTimeout(()=>{ box.style.display='none'; },4000);
    }

    /* ══════════════════════════════════════════
       STEP 2 — OTP VERIFY
    ══════════════════════════════════════════ */
    document.getElementById('formOtp').addEventListener('submit', async e=>{
      e.preventDefault(); hideAlerts();
      const code = otpInputs.map(i=>i.value).join('');
      if(code.length < 6){ showAlert('Masukkan 6 digit kode OTP.'); return; }

      setLoading('btnOtp','btnOtpText','spinnerOtp',true);
      await new Promise(r=>setTimeout(r,1500));
      setLoading('btnOtp','btnOtpText','spinnerOtp',false);

      clearInterval(cdInterval);
      goStep(3);
    });

    /* ══════════════════════════════════════════
       PASSWORD STRENGTH
    ══════════════════════════════════════════ */
    function checkStrength(val){
      const bar=document.getElementById('strengthBar');
      const lbl=document.getElementById('strengthLabel');
      let score=0;
      if(val.length>=8) score++;
      if(/[A-Z]/.test(val)) score++;
      if(/[0-9]/.test(val)) score++;
      if(/[^A-Za-z0-9]/.test(val)) score++;
      const map=[
        {w:'0%',  bg:'transparent',txt:'Masukkan password'},
        {w:'30%', bg:'#ff4f4f',   txt:'Lemah'},
        {w:'55%', bg:'#ffa040',   txt:'Cukup'},
        {w:'78%', bg:'#f0e040',   txt:'Baik'},
        {w:'100%',bg:'#40e090',   txt:'Kuat'},
      ];
      const m=map[score];
      bar.style.width=m.w; bar.style.background=m.bg;
      lbl.textContent=m.txt; lbl.style.color=score===0?'rgba(255,255,255,0.3)':m.bg;
    }

    /* eye toggles */
    function makeEye(btnId,iconId,inputId){
      document.getElementById(btnId).addEventListener('click',()=>{
        const inp=document.getElementById(inputId);
        const icon=document.getElementById(iconId);
        const show=inp.type==='password';
        inp.type=show?'text':'password';
        icon.className=show?'bi bi-eye-slash':'bi bi-eye';
      });
    }
    makeEye('eyeNew','eyeIconNew','newPass');
    makeEye('eyeConf','eyeIconConf','confPass');

    /* ══════════════════════════════════════════
       STEP 3 — RESET PASSWORD SUBMIT
    ══════════════════════════════════════════ */
    document.getElementById('formReset').addEventListener('submit', async e=>{
      e.preventDefault(); hideAlerts();
      const np=document.getElementById('newPass').value;
      const cp=document.getElementById('confPass').value;
      if(!np || np.length<8){ showAlert('Password minimal 8 karakter.'); return; }
      if(np!==cp){ showAlert('Konfirmasi password tidak cocok.'); return; }

      setLoading('btnReset','btnResetText','spinnerReset',true);
      await new Promise(r=>setTimeout(r,1800));
      setLoading('btnReset','btnResetText','spinnerReset',false);

      goStep(4);
    });

  </script>
</body>
</html>
