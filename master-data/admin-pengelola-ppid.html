<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Pengelola — PPID Kota Pekalongan</title>

    <!-- Bootstrap 5.3 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <!-- Select2 -->
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- style select2 -->
    <link rel="stylesheet" href="../asset/css/style.css" />
  </head>
  <body>
    <!-- Sidebar Overlay -->
    <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="closeMobileSidebar()"
    ></div>

    <!-- ══ LOGOUT MODAL ══ -->
    <div class="logout-overlay" id="logoutModal">
      <div class="logout-modal">
        <div class="logout-icon-ring">
          <svg viewBox="0 0 76 76">
            <circle class="ring-dashed" cx="38" cy="38" r="34"></circle>
          </svg>
          <span class="modal-particle"></span>
          <span class="modal-particle"></span>
          <span class="modal-particle"></span>
          <div class="logout-icon-inner">
            <i class="bi bi-box-arrow-right"></i>
          </div>
        </div>
        <h4 class="logout-title">Keluar dari Sistem?</h4>
        <p class="logout-desc">
          Sesi Anda akan diakhiri. Pastikan semua perubahan telah tersimpan.
        </p>
        <div class="logout-btns">
          <button class="btn-cancel" onclick="closeLogoutModal()">Batal</button>
          <button
            class="btn-confirm-red"
            onclick="window.location.href = 'login-ppid.html'"
          >
            <i class="bi bi-box-arrow-right me-1"></i>Ya, Keluar
          </button>
        </div>
      </div>
    </div>

    <!-- ══ MODAL TAMBAH / EDIT ADMIN ══ -->
    <div class="modal-overlay" id="adminModal">
      <div class="modal-box">
        <!-- Header -->
        <div class="modal-header">
          <div class="modal-header-left">
            <div class="modal-icon-badge">
              <i class="bi bi-person-plus-fill"></i>
            </div>
            <div>
              <div class="modal-title" id="modalTitle">
                Tambah Admin Pengelola
              </div>
              <div class="modal-subtitle" id="modalSubtitle">
                Isi data admin baru dengan lengkap
              </div>
            </div>
          </div>
          <button class="modal-close" onclick="closeModal()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <!-- Body -->
        <div class="modal-body">
          <form id="adminForm" novalidate>
            <!-- Nama -->
            <div class="form-group">
              <label class="form-label"
                >Nama Lengkap <span class="required">*</span></label
              >
              <input
                type="text"
                class="form-control"
                id="fNama"
                placeholder="Nama lengkap admin"
              />
              <div class="form-error" id="errNama">
                Nama lengkap wajib diisi.
              </div>
            </div>

            <!-- Username & Email -->
            <div class="form-grid-2">
              <div class="form-group">
                <label class="form-label"
                  >Username <span class="required">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="fUsername"
                  placeholder="username"
                />
                <div class="form-error" id="errUsername">
                  Username wajib diisi.
                </div>
              </div>
              <div class="form-group">
                <label class="form-label"
                  >Email <span class="required">*</span></label
                >
                <input
                  type="email"
                  class="form-control"
                  id="fEmail"
                  placeholder="email@domain.com"
                />
                <div class="form-error" id="errEmail">Email wajib diisi.</div>
              </div>
            </div>

            <!-- Password -->
            <div class="form-group" id="fPasswordGroup">
              <label class="form-label"
                >Password <span class="required">*</span></label
              >
              <div class="input-eye-wrap">
                <input
                  type="password"
                  class="form-control"
                  id="fPassword"
                  placeholder="Min. 8 karakter"
                />
                <button
                  type="button"
                  class="eye-btn"
                  onclick="togglePw('fPassword', this)"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <div class="form-error" id="errPassword">
                Password minimal 8 karakter.
              </div>
            </div>

            <!-- Instansi -->
            <div class="form-group">
              <label class="form-label"
                >Instansi / OPD <span class="required">*</span></label
              >
              <select class="form-control" id="fInstansi" style="display: none">
                <option value="">-- Pilih Instansi --</option>
                <option value="1">Dinas Komunikasi dan Informatika</option>
                <option value="2">Sekretariat Daerah</option>
                <option value="3">Dinas Pendidikan</option>
                <option value="4">Dinas Kesehatan</option>
                <option value="5">Dinas PU dan Penataan Ruang</option>
                <option value="6">Badan Kepegawaian Daerah</option>
                <option value="7">
                  Dinas Kependudukan dan Pencatatan Sipil
                </option>
              </select>
              <div class="form-error" id="errInstansi">
                Instansi wajib dipilih.
              </div>
            </div>

            <!-- Level & Jenis Kelamin -->
            <div class="form-grid-2">
              <div class="form-group">
                <label class="form-label"
                  >Level / Role <span class="required">*</span></label
                >
                <select class="form-control" id="fLevel" style="display: none">
                  <option value="">-- Pilih Level --</option>
                  <option value="administrator">Administrator</option>
                  <option value="admin">Admin</option>
                  <option value="operator">Operator</option>
                </select>
                <div class="form-error" id="errLevel">Level wajib dipilih.</div>
              </div>
              <div class="form-group">
                <label class="form-label"
                  >Jenis Kelamin <span class="required">*</span></label
                >
                <select class="form-control" id="fJk" style="display: none">
                  <option value="">-- Pilih JK --</option>
                  <option value="L">Laki-laki</option>
                  <option value="P">Perempuan</option>
                </select>
                <div class="form-error" id="errJk">
                  Jenis kelamin wajib dipilih.
                </div>
              </div>
            </div>

            <!-- Telepon & Status -->
            <div class="form-grid-2">
              <div class="form-group">
                <label class="form-label">No. Telepon</label>
                <input
                  type="tel"
                  class="form-control"
                  id="fTelp"
                  placeholder="08xxxxxxxxxx"
                />
              </div>
              <div class="form-group">
                <label class="form-label"
                  >Status <span class="required">*</span></label
                >
                <select class="form-control" id="fStatus" style="display: none">
                  <option value="">-- Pilih Status --</option>
                  <option value="1">Aktif</option>
                  <option value="0">Tidak Aktif</option>
                </select>
                <div class="form-error" id="errStatus">
                  Status wajib dipilih.
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
          <button class="btn-outline" onclick="closeModal()">
            <i class="bi bi-x me-1"></i>Batal
          </button>
          <button class="btn-primary" id="btnSimpan" onclick="submitForm()">
            <i class="bi bi-check2 me-1"></i>Simpan Data
          </button>
        </div>
      </div>
    </div>

    <!-- ══ MODAL HAPUS ══ -->
    <div class="modal-overlay" id="deleteModal">
      <div class="modal-box" style="max-width: 420px">
        <div class="modal-header">
          <div class="modal-header-left">
            <div
              class="modal-icon-badge"
              style="background: linear-gradient(135deg, #dc3545, #c0392b)"
            >
              <i class="bi bi-trash3-fill"></i>
            </div>
            <div>
              <div class="modal-title">Hapus Admin</div>
              <div class="modal-subtitle">
                Tindakan ini tidak dapat dibatalkan
              </div>
            </div>
          </div>
          <button class="modal-close" onclick="closeDeleteModal()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-body">
          <p
            style="
              font-size: 0.84rem;
              color: var(--text-muted);
              line-height: 1.7;
            "
          >
            Anda akan menghapus data admin
            <strong id="deleteNama" style="color: var(--text-main)"></strong>.
            Data yang sudah dihapus tidak dapat dikembalikan. Yakin ingin
            melanjutkan?
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn-outline" onclick="closeDeleteModal()">
            <i class="bi bi-x me-1"></i>Batal
          </button>
          <button
            class="btn-primary"
            style="
              background: linear-gradient(135deg, #dc3545, #c0392b);
              box-shadow: 0 4px 14px rgba(220, 53, 69, 0.35);
            "
            onclick="confirmDelete()"
          >
            <i class="bi bi-trash3 me-1"></i>Ya, Hapus
          </button>
        </div>
      </div>
    </div>

    <!-- ══ MODAL DETAIL ══ -->
    <div class="modal-overlay" id="detailModal">
      <div class="modal-box" style="max-width: 480px">
        <div class="modal-header">
          <div class="modal-header-left">
            <div class="modal-icon-badge">
              <i class="bi bi-person-vcard-fill"></i>
            </div>
            <div>
              <div class="modal-title">Detail Admin Pengelola</div>
              <div class="modal-subtitle">Informasi lengkap akun</div>
            </div>
          </div>
          <button class="modal-close" onclick="closeDetailModal()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="detailContent"></div>
        </div>
        <div class="modal-footer">
          <button class="btn-outline" onclick="closeDetailModal()">
            Tutup
          </button>
        </div>
      </div>
    </div>

    <!-- ══ APP SHELL ══ -->
    <div class="app-shell">
      <!-- ════ SIDEBAR ════ -->
      <aside class="sidebar" id="sidebar">
        <a class="sidebar-brand" href="dashboard-ppid.html">
          <div class="brand-icon"><i class="bi bi-shield-lock-fill"></i></div>
          <div class="brand-text">
            <div class="brand-title">PPID Pekalongan</div>
            <div class="brand-sub">Kota Pekalongan · v2.0</div>
          </div>
        </a>

        <nav class="sidebar-scroll">
          <div class="nav-item-wrapper">
            <a
              href="../dashboard-ppid.html"
              class="nav-link-custom"
              data-tip="Dashboard"
            >
              <i class="bi bi-grid-1x2-fill nav-icon"></i>
              <span class="nav-label">Dashboard</span>
            </a>
          </div>

          <div class="nav-section-label">Master Data</div>
          <div class="nav-item-wrapper">
            <a
              href="#"
              class="nav-link-custom active"
              data-tip="Admin Pengelola"
            >
              <i class="bi bi-person-badge-fill nav-icon"></i>
              <span class="nav-label">Admin Pengelola</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Pemohon">
              <i class="bi bi-people-fill nav-icon"></i>
              <span class="nav-label">Pemohon</span>
              <span class="nav-badge">12</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Instansi">
              <i class="bi bi-building nav-icon"></i>
              <span class="nav-label">Instansi / OPD</span>
            </a>
          </div>

          <div class="nav-section-label">Kelompok Informasi</div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Kelinfo DIP">
              <i class="bi bi-folder2-open nav-icon"></i>
              <span class="nav-label">Kelinfo DIP</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Kelinfo DIB">
              <i class="bi bi-folder-fill nav-icon"></i>
              <span class="nav-label">Kelinfo DIB</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Kelinfo DIBS">
              <i class="bi bi-folder-symlink-fill nav-icon"></i>
              <span class="nav-label">Kelinfo DIBS</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Kelinfo DIU">
              <i class="bi bi-archive-fill nav-icon"></i>
              <span class="nav-label">Kelinfo DIU</span>
            </a>
          </div>

          <div class="nav-section-label">Permohonan</div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Permohonan Masuk">
              <i class="bi bi-inbox-fill nav-icon"></i>
              <span class="nav-label">Permohonan Masuk</span>
              <span class="nav-badge">7</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Riwayat">
              <i class="bi bi-clock-history nav-icon"></i>
              <span class="nav-label">Riwayat Permohonan</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Laporan">
              <i class="bi bi-bar-chart-fill nav-icon"></i>
              <span class="nav-label">Laporan & Statistik</span>
            </a>
          </div>

          <div class="nav-section-label">Konten Website</div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Galeri">
              <i class="bi bi-images nav-icon"></i>
              <span class="nav-label">Galeri</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Infografis">
              <i class="bi bi-pie-chart-fill nav-icon"></i>
              <span class="nav-label">Infografis</span>
            </a>
          </div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Menu">
              <i class="bi bi-list-nested nav-icon"></i>
              <span class="nav-label">Kelola Menu</span>
            </a>
          </div>

          <div class="nav-section-label">Pengaturan</div>
          <div class="nav-item-wrapper">
            <a href="#" class="nav-link-custom" data-tip="Pengaturan">
              <i class="bi bi-gear-fill nav-icon"></i>
              <span class="nav-label">Pengaturan Sistem</span>
            </a>
          </div>
        </nav>

        <div class="sidebar-footer">
          <div class="sidebar-footer-inner">
            <div class="sf-icon"><i class="bi bi-info-circle"></i></div>
            <div class="sf-text">
              <div class="sf-version">Versi 2.0.1 — Stabil</div>
              <div class="sf-copy">&copy; 2025 PPID Kota Pekalongan</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- ════ MAIN AREA ════ -->
      <div class="main-area" id="mainArea">
        <!-- TOPBAR -->
        <header class="topbar">
          <button class="toggle-btn" id="toggleBtn" onclick="toggleSidebar()">
            <i class="bi bi-arrow-bar-left" id="toggleIcon"></i>
          </button>
          <div class="topbar-spacer"></div>
          <div class="topbar-right">
            <button class="topbar-icon-btn" title="Notifikasi">
              <i class="bi bi-bell"></i>
              <span class="notif-dot"></span>
            </button>
            <button
              class="topbar-icon-btn"
              title="Layar Penuh"
              onclick="toggleFullscreen()"
            >
              <i class="bi bi-fullscreen" id="fsIcon"></i>
            </button>
            <div class="user-menu">
              <button
                class="user-trigger"
                id="userTrigger"
                onclick="toggleUserMenu()"
                aria-expanded="false"
              >
                <div class="user-avatar">AS</div>
                <div class="user-info">
                  <div class="user-name">Admin Sistem</div>
                  <div class="user-role">@admin.ppid</div>
                </div>
                <i class="bi bi-chevron-down user-caret"></i>
              </button>
              <div class="user-dropdown" id="userDropdown">
                <a class="dd-item" href="#"
                  ><i class="bi bi-person-circle"></i>Profil Saya</a
                >
                <a class="dd-item" href="#"
                  ><i class="bi bi-gear"></i>Pengaturan</a
                >
                <div class="dd-divider"></div>
                <button class="dd-item danger" onclick="openLogoutModal()">
                  <i class="bi bi-box-arrow-right"></i>Keluar
                </button>
              </div>
            </div>
          </div>
        </header>

        <!-- CONTENT -->
        <main class="content-area">
          <!-- Breadcrumb Banner -->
          <div class="breadcrumb-banner">
            <div class="bb-left">
              <div class="bb-page-name">Admin Pengelola</div>
              <div class="bb-desc">
                Kelola data akun admin pengelola sistem PPID
              </div>
            </div>
            <div class="bb-right">
              <div class="bb-crumb-item">
                <i class="bi bi-house-fill"></i>Home
              </div>
              <span class="bb-crumb-sep">/</span>
              <div class="bb-crumb-item">Master Data</div>
              <span class="bb-crumb-sep">/</span>
              <div class="bb-crumb-item active">
                <i class="bi bi-person-badge-fill"></i>Admin Pengelola
              </div>
            </div>
          </div>

          <!-- Card Tabel -->
          <div class="card">
            <div class="card-header">
              <div class="card-title-section">
                <i class="bi bi-person-badge-fill"></i>
                <h6>Daftar Admin Pengelola</h6>
              </div>
              <button class="btn-primary" onclick="openModal('tambah')">
                <i class="bi bi-plus-lg"></i>Tambah Admin
              </button>
            </div>

            <div class="card-body">
              <!-- Filter Toolbar -->
              <div class="filter-toolbar">
                <div class="filter-left">
                  <!-- Search — selalu full width di mobile, auto di desktop -->
                  <div class="input-wrap">
                    <i class="bi bi-search input-icon"></i>
                    <input
                      type="text"
                      class="input input-search"
                      id="searchInput"
                      placeholder="Cari nama / username..."
                      oninput="filterTable()"
                    />
                  </div>

                  <!-- Select2 Instansi + Status + Reset dibungkus supaya rapi di mobile -->
                  <div class="filter-selects-row">
                    <!-- Select2 Instansi -->
                    <select
                      id="filterInstansi"
                      style="display: none"
                      onchange="filterTable()"
                    >
                      <option value="">Semua Instansi</option>
                      <option value="Kominfo">Dinas Kominfo</option>
                      <option value="Sekda">Sekretariat Daerah</option>
                      <option value="Disdik">Dinas Pendidikan</option>
                      <option value="Dinkes">Dinas Kesehatan</option>
                    </select>
                    <!-- Select2 Status -->
                    <select
                      id="filterStatus"
                      style="display: none"
                      onchange="filterTable()"
                    >
                      <option value="">Semua Status</option>
                      <option value="aktif">Aktif</option>
                      <option value="nonaktif">Tidak Aktif</option>
                    </select>
                  </div>

                  <!-- Reset (visible di semua ukuran, posisi disesuaikan CSS) -->
                  <div class="filter-reset-wrap">
                    <button
                      class="btn-icon-only btn-reset"
                      onclick="resetFilter()"
                      title="Reset Filter"
                    >
                      <i class="bi bi-arrow-counterclockwise"></i>
                    </button>
                  </div>
                </div>

                <div class="filter-right">
                  <span
                    style="
                      font-size: 0.78rem;
                      color: var(--text-muted);
                      white-space: nowrap;
                    "
                    >Tampilkan</span
                  >
                  <select
                    class="select-perpage"
                    id="perPage"
                    onchange="renderTable()"
                  >
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                  </select>
                  <span style="font-size: 0.78rem; color: var(--text-muted)"
                    >data</span
                  >
                </div>
              </div>

              <!-- Table (desktop) -->
              <div class="table-responsive-wrap">
                <table class="table" id="adminTable">
                  <thead>
                    <tr>
                      <th class="col-no">No</th>
                      <th class="sortable" onclick="sortTable('nama')">
                        Nama <i class="bi bi-arrow-down-up sort-icon"></i>
                      </th>
                      <th>Instansi</th>
                      <th>Username</th>
                      <th>Level</th>
                      <th>Status</th>
                      <th class="col-aksi" style="text-align: center">Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="tableBody">
                    <!-- dirender oleh JS -->
                  </tbody>
                </table>
                <!-- Empty state -->
                <div class="empty-state" id="emptyState" style="display: none">
                  <i class="bi bi-people"></i>
                  <p>Tidak ada data yang ditemukan.</p>
                </div>
              </div>

              <!-- Mobile Card List (≤575px) -->
              <div class="mobile-list" id="mobileList">
                <!-- dirender oleh JS -->
              </div>
              <div
                class="empty-state"
                id="emptyStateMobile"
                style="display: none"
              >
                <i class="bi bi-people"></i>
                <p>Tidak ada data yang ditemukan.</p>
              </div>

              <!-- Pagination -->
              <div class="pagination-row">
                <div class="pagination-info" id="paginationInfo"></div>
                <div class="pagination-controls" id="paginationControls"></div>
              </div>
            </div>
          </div>
          <!-- end card -->
        </main>

        <!-- FOOTER -->
        <footer class="main-footer">
          <div class="footer-left">
            &copy; 2025 <strong>PPID Kota Pekalongan</strong> — Sistem Informasi
            Layanan Publik. All rights reserved.
          </div>
          <div class="footer-right">
            <a class="footer-link" href="#">Bantuan</a>
            <span class="footer-sep">·</span>
            <a class="footer-link" href="#">Kebijakan Privasi</a>
            <span class="footer-sep">·</span>
            <a class="footer-link" href="#">Kontak</a>
          </div>
        </footer>
      </div>
      <!-- end main-area -->
    </div>
    <!-- end app-shell -->

    <!-- FAB -->
    <button
      class="fab-top"
      id="fabTop"
      onclick="scrollToTop()"
      title="Kembali ke atas"
    >
      <i class="bi bi-arrow-up"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      /* ══════════════════════════════════════════════════════
   DATA SAMPLE
══════════════════════════════════════════════════════ */
      let adminData = [
        {
          id: 1,
          nama: "Budi Santoso Wicaksono",
          instansi: "Kominfo",
          instansi_full: "Dinas Komunikasi dan Informatika",
          username: "budi.santoso",
          email: "budi.santoso@pekalongan.go.id",
          level: "administrator",
          jk: "L",
          telp: "08121234567",
          status: "aktif",
          last_active: "23 Feb 2025, 09:32",
        },
        {
          id: 2,
          nama: "Siti Rahma Dewi",
          instansi: "Sekda",
          instansi_full: "Sekretariat Daerah",
          username: "siti.rahma",
          email: "siti.rahma@pekalongan.go.id",
          level: "admin",
          jk: "P",
          telp: "08229876543",
          status: "aktif",
          last_active: "23 Feb 2025, 11:15",
        },
      ];

      let filteredData = [...adminData];
      let currentPage = 1;
      let sortKey = "";
      let sortDir = "asc";
      let deleteId = null;
      let editId = null;

      /* ══════════════════════════════════════════════════════
   SELECT2 INIT
══════════════════════════════════════════════════════ */
      $(document).ready(function () {
        // Filter selects
        $("#filterInstansi").select2({
          placeholder: "Semua Instansi",
          allowClear: true,
          width: "resolve",
          minimumResultsForSearch: Infinity,
        });
        $("#filterStatus").select2({
          placeholder: "Semua Status",
          allowClear: true,
          width: "resolve",
          minimumResultsForSearch: Infinity,
        });

        // Modal selects
        $("#fInstansi").select2({
          placeholder: "-- Pilih Instansi --",
          allowClear: true,
          dropdownParent: $("#adminModal"),
          width: "100%",
        });
        $("#fLevel").select2({
          placeholder: "-- Pilih Level --",
          allowClear: true,
          dropdownParent: $("#adminModal"),
          width: "100%",
        });
        $("#fJk").select2({
          placeholder: "-- Pilih JK --",
          allowClear: true,
          dropdownParent: $("#adminModal"),
          width: "100%",
          minimumResultsForSearch: Infinity,
        });
        $("#fStatus").select2({
          placeholder: "-- Pilih Status --",
          allowClear: true,
          dropdownParent: $("#adminModal"),
          width: "100%",
          minimumResultsForSearch: Infinity,
        });

        // on change trigger filter
        $("#filterInstansi, #filterStatus").on("change", filterTable);

        // Render table
        renderTable();
      });

      /* ══════════════════════════════════════════════════════
   TABLE RENDER
══════════════════════════════════════════════════════ */
      /* ambil inisial nama untuk avatar mobile */
      function getInitials(nama) {
        const parts = nama.trim().split(/\s+/);
        return (parts[0][0] + (parts[1] ? parts[1][0] : "")).toUpperCase();
      }

      /* pill badge penuh untuk mobile (seperti referensi) */
      function getLevelPill(level) {
        const map = {
          administrator: { bg: "#0072c6", label: "Administrator" },
          admin: { bg: "#10b964", label: "Admin" },
          operator: { bg: "#f59e0b", label: "Operator" },
        };
        const c = map[level] || { bg: "#64748b", label: level };
        return `<span style="background:${c.bg};color:#fff;padding:.26rem .72rem;border-radius:7px;font-size:.73rem;font-weight:700;white-space:nowrap;">${c.label}</span>`;
      }

      function renderTable() {
        const perPage = parseInt(document.getElementById("perPage").value);
        const total = filteredData.length;
        const start = (currentPage - 1) * perPage;
        const end = Math.min(start + perPage, total);
        const slice = filteredData.slice(start, end);

        /* ── DESKTOP: tabel biasa ── */
        const tbody = document.getElementById("tableBody");
        const empty = document.getElementById("emptyState");

        /* ── MOBILE: card list ── */
        const mobList = document.getElementById("mobileList");
        const mobEmpty = document.getElementById("emptyStateMobile");
        const isMobileView = window.innerWidth <= 575;

        if (slice.length === 0) {
          tbody.innerHTML = "";
          mobList.innerHTML = "";

          if (isMobileView) {
            empty.style.display = "none";
            mobEmpty.style.display = "block";
          } else {
            empty.style.display = "block";
            mobEmpty.style.display = "none";
          }
        } else {
          empty.style.display = "none";
          mobEmpty.style.display = "none";

          /* render desktop rows */
          tbody.innerHTML = slice
            .map((row, i) => {
              const no = start + i + 1;
              const levelBadge = getLevelBadge(row.level);
              const statusBadge = getStatusBadge(row.status);
              return `
        <tr>
          <td class="col-no">${no}</td>
          <td>
            <div style="font-weight:600;color:var(--text-main);font-size:.84rem;">${row.nama}</div>
            <div style="font-size:.72rem;color:var(--text-muted);">${row.email}</div>
          </td>
          <td>
            <div style="font-size:.82rem;">${row.instansi_full}</div>
            <div style="font-size:.7rem;color:var(--text-muted);">${row.instansi}</div>
          </td>
          <td>
            <code style="font-size:.78rem;background:#f0f4f9;padding:.15rem .45rem;border-radius:5px;color:var(--blue);">@${row.username}</code>
          </td>
          <td>${levelBadge}</td>
          <td>${statusBadge}</td>
          <td class="col-aksi">
            <div class="aksi-group" style="justify-content:center;">
              <button class="btn-icon-only btn-detail" onclick="openDetail(${row.id})" title="Detail"><i class="bi bi-eye"></i></button>
              <button class="btn-icon-only btn-edit"   onclick="openModal('edit',${row.id})" title="Edit"><i class="bi bi-pencil"></i></button>
              <button class="btn-icon-only btn-delete" onclick="openDelete(${row.id})" title="Hapus"><i class="bi bi-trash3"></i></button>
            </div>
          </td>
        </tr>`;
            })
            .join("");

          /* render mobile card list */
          mobList.innerHTML = slice
            .map((row, i) => {
              const no = start + i + 1;
              const init = getInitials(row.nama);
              const pill = getLevelPill(row.level);
              return `
        <div class="m-item">
          <div class="m-no">${no}</div>
          <div class="m-av">${init}</div>
          <div class="m-body">
            <div class="m-name">${row.nama}</div>
            <div class="m-email">${row.email}</div>
          </div>
          <div class="m-role">${pill}</div>
        </div>`;
            })
            .join("");
        }

        /* pagination info */
        document.getElementById("paginationInfo").innerHTML =
          total === 0
            ? "Tidak ada data"
            : `Menampilkan <strong>${start + 1}–${end}</strong> dari <strong>${total}</strong> data`;

        renderPagination(total, perPage);
      }

      function getLevelBadge(level) {
        const map = {
          administrator: `<span class="badge badge-blue"><span class="badge-dot badge-dot-blue"></span>Administrator</span>`,
          admin: `<span class="badge badge-green"><span class="badge-dot badge-dot-green"></span>Admin</span>`,
          operator: `<span class="badge badge-amber"><span class="badge-dot badge-dot-amber"></span>Operator</span>`,
        };
        return map[level] || `<span class="badge badge-gray">${level}</span>`;
      }

      function getStatusBadge(status) {
        return status === "aktif"
          ? `<span class="badge badge-green"><span class="badge-dot badge-dot-green"></span>Aktif</span>`
          : `<span class="badge badge-gray"><span class="badge-dot badge-dot-gray"></span>Tidak Aktif</span>`;
      }

      /* ══════════════════════════════════════════════════════
   PAGINATION
══════════════════════════════════════════════════════ */
      function renderPagination(total, perPage) {
        const pages = Math.ceil(total / perPage) || 1;
        const ctrl = document.getElementById("paginationControls");

        // Selalu tampilkan navigation buttons (prev / next + halaman)
        let html = `
    <button class="page-btn" onclick="goPage(${currentPage - 1})" ${currentPage === 1 ? "disabled" : ""}>
      <i class="bi bi-chevron-left"></i>
    </button>`;

        if (pages <= 7) {
          for (let p = 1; p <= pages; p++) {
            html += `<button class="page-btn ${p === currentPage ? "active" : ""}" onclick="goPage(${p})">${p}</button>`;
          }
        } else {
          // tampilkan dengan ellipsis jika banyak
          for (let p = 1; p <= pages; p++) {
            if (
              p === 1 ||
              p === pages ||
              (p >= currentPage - 1 && p <= currentPage + 1)
            ) {
              html += `<button class="page-btn ${p === currentPage ? "active" : ""}" onclick="goPage(${p})">${p}</button>`;
            } else if (p === currentPage - 2 || p === currentPage + 2) {
              html += `<button class="page-btn" style="pointer-events:none;cursor:default;">…</button>`;
            }
          }
        }

        html += `
    <button class="page-btn" onclick="goPage(${currentPage + 1})" ${currentPage >= pages ? "disabled" : ""}>
      <i class="bi bi-chevron-right"></i>
    </button>`;

        ctrl.innerHTML = html;
      }

      function goPage(p) {
        const perPage = parseInt(document.getElementById("perPage").value);
        const maxPage = Math.ceil(filteredData.length / perPage);
        if (p < 1 || p > maxPage) return;
        currentPage = p;
        renderTable();
      }

      /* ══════════════════════════════════════════════════════
   FILTER & SEARCH
══════════════════════════════════════════════════════ */
      function filterTable() {
        const search = document
          .getElementById("searchInput")
          .value.toLowerCase()
          .trim();
        const instansi = $("#filterInstansi").val() || "";
        const status = $("#filterStatus").val() || "";

        filteredData = adminData.filter((row) => {
          const matchSearch =
            !search ||
            row.nama.toLowerCase().includes(search) ||
            row.username.toLowerCase().includes(search) ||
            row.email.toLowerCase().includes(search);
          const matchInstansi = !instansi || row.instansi === instansi;
          const matchStatus = !status || row.status === status;
          return matchSearch && matchInstansi && matchStatus;
        });

        currentPage = 1;
        renderTable();
      }

      function resetFilter() {
        document.getElementById("searchInput").value = "";
        $("#filterInstansi").val("").trigger("change");
        $("#filterStatus").val("").trigger("change");
        filteredData = [...adminData];
        currentPage = 1;
        renderTable();
      }

      /* ══════════════════════════════════════════════════════
   SORT
══════════════════════════════════════════════════════ */
      function sortTable(key) {
        if (sortKey === key) sortDir = sortDir === "asc" ? "desc" : "asc";
        else {
          sortKey = key;
          sortDir = "asc";
        }

        filteredData.sort((a, b) => {
          const v1 = (a[key] || "").toLowerCase();
          const v2 = (b[key] || "").toLowerCase();
          return sortDir === "asc"
            ? v1.localeCompare(v2)
            : v2.localeCompare(v1);
        });
        currentPage = 1;
        renderTable();
      }

      /* ══════════════════════════════════════════════════════
   MODAL TAMBAH / EDIT
══════════════════════════════════════════════════════ */
      function openModal(mode, id = null) {
        editId = id;
        const overlay = document.getElementById("adminModal");

        if (mode === "tambah") {
          document.getElementById("modalTitle").textContent =
            "Tambah Admin Pengelola";
          document.getElementById("modalSubtitle").textContent =
            "Isi data admin baru dengan lengkap";
          document.getElementById("fPasswordGroup").style.display = "";
          resetForm();
        } else {
          const row = adminData.find((r) => r.id === id);
          if (!row) return;
          document.getElementById("modalTitle").textContent =
            "Edit Admin Pengelola";
          document.getElementById("modalSubtitle").textContent =
            `Perbarui data untuk @${row.username}`;
          document.getElementById("fPasswordGroup").style.display = "none";

          document.getElementById("fNama").value = row.nama;
          document.getElementById("fUsername").value = row.username;
          document.getElementById("fEmail").value = row.email;
          document.getElementById("fTelp").value = row.telp;
          $("#fInstansi")
            .val(Object.keys({ 1: "Kominfo" })[0] || "")
            .trigger("change");
          $("#fLevel").val(row.level).trigger("change");
          $("#fJk").val(row.jk).trigger("change");
          $("#fStatus")
            .val(row.status === "aktif" ? "1" : "0")
            .trigger("change");
        }

        overlay.classList.add("show");
      }

      function closeModal() {
        document.getElementById("adminModal").classList.remove("show");
        editId = null;
        resetForm();
      }

      function resetForm() {
        ["fNama", "fUsername", "fEmail", "fPassword", "fTelp"].forEach((id) => {
          document.getElementById(id).value = "";
          document.getElementById(id).classList.remove("is-invalid");
        });
        ["fInstansi", "fLevel", "fJk", "fStatus"].forEach((id) => {
          $(`#${id}`).val("").trigger("change");
        });
        document
          .querySelectorAll(".form-error")
          .forEach((el) => el.classList.remove("show"));
      }

      function submitForm() {
        let valid = true;

        const nama = document.getElementById("fNama").value.trim();
        const username = document.getElementById("fUsername").value.trim();
        const email = document.getElementById("fEmail").value.trim();
        const password = document.getElementById("fPassword").value;
        const instansi = $("#fInstansi").val();
        const level = $("#fLevel").val();
        const jk = $("#fJk").val();
        const status = $("#fStatus").val();

        function setErr(fieldId, errId, cond) {
          const field = document.getElementById(fieldId);
          const err = document.getElementById(errId);
          if (cond) {
            field && field.classList.add("is-invalid");
            err && err.classList.add("show");
            valid = false;
          } else {
            field && field.classList.remove("is-invalid");
            err && err.classList.remove("show");
          }
        }

        setErr("fNama", "errNama", !nama);
        setErr("fUsername", "errUsername", !username);
        setErr("fEmail", "errEmail", !email || !/\S+@\S+\.\S+/.test(email));
        setErr("fInstansi", "errInstansi", !instansi);
        setErr("fLevel", "errLevel", !level);
        setErr("fJk", "errJk", !jk);
        setErr("fStatus", "errStatus", !status);

        if (editId === null) {
          setErr("fPassword", "errPassword", !password || password.length < 8);
        }

        if (!valid) return;

        const instansiMap = {
          1: "Kominfo",
          2: "Sekda",
          3: "Disdik",
          4: "Dinkes",
          5: "PU",
          6: "BKD",
          7: "Disdukcapil",
        };
        const instansiFullMap = {
          1: "Dinas Komunikasi dan Informatika",
          2: "Sekretariat Daerah",
          3: "Dinas Pendidikan",
          4: "Dinas Kesehatan",
          5: "Dinas PU dan Penataan Ruang",
          6: "Badan Kepegawaian Daerah",
          7: "Dinas Kependudukan dan Pencatatan Sipil",
        };

        if (editId === null) {
          // Tambah
          const newRow = {
            id: adminData.length
              ? Math.max(...adminData.map((r) => r.id)) + 1
              : 1,
            nama,
            username,
            email,
            instansi: instansiMap[instansi] || instansi,
            instansi_full: instansiFullMap[instansi] || instansi,
            level,
            jk,
            telp: document.getElementById("fTelp").value.trim(),
            status: status === "1" ? "aktif" : "nonaktif",
            last_active: "Baru",
          };
          adminData.unshift(newRow);
        } else {
          // Edit
          const idx = adminData.findIndex((r) => r.id === editId);
          if (idx > -1) {
            adminData[idx] = {
              ...adminData[idx],
              nama,
              username,
              email,
              level,
              jk,
              instansi: instansiMap[instansi] || adminData[idx].instansi,
              instansi_full:
                instansiFullMap[instansi] || adminData[idx].instansi_full,
              telp: document.getElementById("fTelp").value.trim(),
              status: status === "1" ? "aktif" : "nonaktif",
            };
          }
        }

        filteredData = [...adminData];
        currentPage = 1;
        renderTable();
        closeModal();
      }

      /* ══════════════════════════════════════════════════════
   MODAL HAPUS
══════════════════════════════════════════════════════ */
      function openDelete(id) {
        deleteId = id;
        const row = adminData.find((r) => r.id === id);
        document.getElementById("deleteNama").textContent = row ? row.nama : "";
        document.getElementById("deleteModal").classList.add("show");
      }
      function closeDeleteModal() {
        document.getElementById("deleteModal").classList.remove("show");
        deleteId = null;
      }
      function confirmDelete() {
        adminData = adminData.filter((r) => r.id !== deleteId);
        filteredData = [...adminData];
        if (
          (currentPage - 1) *
            parseInt(document.getElementById("perPage").value) >=
            filteredData.length &&
          currentPage > 1
        )
          currentPage--;
        renderTable();
        closeDeleteModal();
      }

      /* ══════════════════════════════════════════════════════
   MODAL DETAIL
══════════════════════════════════════════════════════ */
      function openDetail(id) {
        const row = adminData.find((r) => r.id === id);
        if (!row) return;
        const jkLabel = row.jk === "L" ? "Laki-laki" : "Perempuan";
        document.getElementById("detailContent").innerHTML = `
    <div style="display:flex;flex-direction:column;gap:.85rem;">
      ${detailRow("bi-person", "Nama Lengkap", row.nama)}
      ${detailRow("bi-at", "Username", "@" + row.username)}
      ${detailRow("bi-envelope", "Email", row.email)}
      ${detailRow("bi-building", "Instansi", row.instansi_full)}
      ${detailRow("bi-shield-check", "Level", `<span class="badge ${row.level === "administrator" ? "badge-blue" : row.level === "admin" ? "badge-green" : "badge-amber"}">${row.level}</span>`)}
      ${detailRow("bi-gender-ambiguous", "Jenis Kelamin", jkLabel)}
      ${detailRow("bi-telephone", "Telepon", row.telp || "-")}
      ${detailRow("bi-circle-fill", "Status", getStatusBadge(row.status))}
      ${detailRow("bi-clock", "Aktivitas Terakhir", row.last_active)}
    </div>
  `;
        document.getElementById("detailModal").classList.add("show");
      }
      function detailRow(icon, label, value) {
        return `
    <div style="display:flex;gap:.9rem;align-items:flex-start;padding-bottom:.85rem;border-bottom:1px solid var(--border-light);">
      <div style="width:34px;height:34px;border-radius:9px;background:var(--blue-soft);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <i class="bi ${icon}" style="color:var(--blue);font-size:.9rem;"></i>
      </div>
      <div>
        <div style="font-size:.7rem;color:var(--text-muted);font-weight:600;letter-spacing:.04em;text-transform:uppercase;margin-bottom:.18rem;">${label}</div>
        <div style="font-size:.85rem;color:var(--text-main);font-weight:500;">${value}</div>
      </div>
    </div>
  `;
      }
      function closeDetailModal() {
        document.getElementById("detailModal").classList.remove("show");
      }

      /* close modals on overlay click */
      ["adminModal", "deleteModal", "detailModal"].forEach((id) => {
        document.getElementById(id).addEventListener("click", (e) => {
          if (e.target === document.getElementById(id)) {
            document.getElementById(id).classList.remove("show");
          }
        });
      });

      /* ══════════════════════════════════════════════════════
   PASSWORD TOGGLE
══════════════════════════════════════════════════════ */
      function togglePw(inputId, btn) {
        const inp = document.getElementById(inputId);
        const icon = btn.querySelector("i");
        const show = inp.type === "password";
        inp.type = show ? "text" : "password";
        icon.className = show ? "bi bi-eye-slash" : "bi bi-eye";
      }

      /* ══════════════════════════════════════════════════════
   SIDEBAR TOGGLE
══════════════════════════════════════════════════════ */
      const sidebar = document.getElementById("sidebar");
      const mainArea = document.getElementById("mainArea");
      const toggleBtn = document.getElementById("toggleBtn");
      const overlay = document.getElementById("sidebarOverlay");
      let isCollapsed = false;
      const isMobile = () => window.innerWidth <= 991;

      function toggleSidebar() {
        if (isMobile()) {
          toggleMobileSidebar();
        } else {
          isCollapsed = !isCollapsed;
          sidebar.classList.toggle("collapsed", isCollapsed);
          mainArea.classList.toggle("collapsed", isCollapsed);
          toggleBtn.classList.toggle("collapsed-state", isCollapsed);
        }
      }
      function toggleMobileSidebar() {
        const open = sidebar.classList.toggle("mobile-open");
        overlay.classList.toggle("show", open);
      }
      function closeMobileSidebar() {
        sidebar.classList.remove("mobile-open");
        overlay.classList.remove("show");
      }

      /* ══════════════════════════════════════════════════════
   USER DROPDOWN
══════════════════════════════════════════════════════ */
      const userTrigger = document.getElementById("userTrigger");
      const userDropdown = document.getElementById("userDropdown");
      function toggleUserMenu() {
        const open = userDropdown.classList.toggle("show");
        userTrigger.setAttribute("aria-expanded", open);
      }
      document.addEventListener("click", (e) => {
        if (!userTrigger.contains(e.target) && !userDropdown.contains(e.target))
          userDropdown.classList.remove("show");
      });

      /* ══════════════════════════════════════════════════════
   LOGOUT MODAL
══════════════════════════════════════════════════════ */
      function openLogoutModal() {
        userDropdown.classList.remove("show");
        document.getElementById("logoutModal").classList.add("show");
      }
      function closeLogoutModal() {
        document.getElementById("logoutModal").classList.remove("show");
      }
      document.getElementById("logoutModal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("logoutModal"))
          closeLogoutModal();
      });

      /* ══════════════════════════════════════════════════════
   FULLSCREEN
══════════════════════════════════════════════════════ */
      function toggleFullscreen() {
        const icon = document.getElementById("fsIcon");
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
          icon.className = "bi bi-fullscreen-exit";
        } else {
          document.exitFullscreen();
          icon.className = "bi bi-fullscreen";
        }
      }

      /* ══════════════════════════════════════════════════════
   FAB SCROLL TO TOP
══════════════════════════════════════════════════════ */
      const fabTop = document.getElementById("fabTop");
      window.addEventListener("scroll", () => {
        fabTop.classList.toggle("visible", window.scrollY > 300);
      });
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      /* nav active on click */
      document.querySelectorAll(".nav-link-custom").forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          document
            .querySelectorAll(".nav-link-custom")
            .forEach((l) => l.classList.remove("active"));
          this.classList.add("active");
          if (isMobile()) closeMobileSidebar();
        });
      });
    </script>
  </body>
</html>
